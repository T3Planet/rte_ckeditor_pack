import{Plugin as C}from"@ckeditor/ckeditor5-core";import{FileRepository as d}from"@ckeditor/ckeditor5-upload";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const l="ckCsrfToken",u=40,p="abcdefghijklmnopqrstuvwxyz0123456789";function c(){let r=h(l);return(!r||r.length!=u)&&(r=k(u),f(l,r)),r}function h(r){r=r.toLowerCase();const e=document.cookie.split(";");for(const t of e){const o=t.split("=");if(decodeURIComponent(o[0].trim().toLowerCase())===r)return decodeURIComponent(o[1])}return null}function f(r,e){document.cookie=encodeURIComponent(r)+"="+encodeURIComponent(e)+";path=/"}function k(r){let e="";const t=new Uint8Array(r);window.crypto.getRandomValues(t);for(let o=0;o<t.length;o++){const s=p.charAt(t[o]%p.length);e+=Math.random()>.5?s.toUpperCase():s}return e}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class m extends C{static get requires(){return[d]}static get pluginName(){return"CKFinderUploadAdapter"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.config.get("ckfinder.uploadUrl");e&&(this.editor.plugins.get(d).createUploadAdapter=t=>new _(t,e,this.editor.t))}}class _{loader;url;t;xhr;constructor(e,t,o){this.loader=e,this.url=t,this.t=o}upload(){return this.loader.file.then(e=>new Promise((t,o)=>{this._initRequest(),this._initListeners(t,o,e),this._sendRequest(e)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}_initListeners(e,t,o){const s=this.xhr,i=this.loader,g=this.t,a=g("Cannot upload file:")+` ${o.name}.`;s.addEventListener("error",()=>t(a)),s.addEventListener("abort",()=>t()),s.addEventListener("load",()=>{const n=s.response;if(!n||!n.uploaded)return t(n&&n.error&&n.error.message?n.error.message:a);e({default:n.url})});/* istanbul ignore else -- @preserve */s.upload&&s.upload.addEventListener("progress",n=>{n.lengthComputable&&(i.uploadTotal=n.total,i.uploaded=n.loaded)})}_sendRequest(e){const t=new FormData;t.append("upload",e),t.append("ckCsrfToken",c()),this.xhr.send(t)}}export{m as CKFinderUploadAdapter,h as _getCKFinderCookie,c as _getCKFinderCsrfToken,f as _setCKFinderCookie};
