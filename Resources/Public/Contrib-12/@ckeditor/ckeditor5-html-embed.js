import{Command as S,Plugin as k}from"@ckeditor/ckeditor5-core";import{findOptimalInsertionRange as T,toWidget as V,Widget as A}from"@ckeditor/ckeditor5-widget";import{ButtonView as _,MenuBarMenuListItemButtonView as I}from"@ckeditor/ckeditor5-ui";import{logWarning as L,createElement as h}from"@ckeditor/ckeditor5-utils";import{IconPencil as E,IconCheck as D,IconCancel as M,IconHtml as O}from"@ckeditor/ckeditor5-icons";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class C extends S{refresh(){const e=this.editor.model,t=e.schema,n=e.document.selection,a=H(n);this.isEnabled=W(n,t,e),this.value=a?a.getAttribute("value")||"":null}execute(e){const t=this.editor.model,n=t.document.selection;t.change(a=>{let b;this.value!==null?b=H(n):(b=a.createElement("rawHtml"),t.insertObject(b,null,null,{setSelection:"on"})),a.setAttribute("value",e,b)})}}function W(c,e,t){const n=N(c,t);return e.checkChild(n,"rawHtml")}function N(c,e){const n=T(c,e).start.parent;return n.isEmpty&&!n.is("rootElement")?n.parent:n}function H(c){const e=c.getSelectedElement();return e&&e.is("element","rawHtml")?e:null}function j(c,{insertAt:e}={}){if(typeof document>"u")return;const t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",window.litNonce&&n.setAttribute("nonce",window.litNonce),e==="top"&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=c:n.appendChild(document.createTextNode(c))}j(".ck-widget.raw-html-embed{display:flow-root;font-style:normal;margin:.9em auto;min-width:15em;position:relative}.ck-widget.raw-html-embed:before{position:absolute;z-index:1}.ck-widget.raw-html-embed .raw-html-embed__buttons-wrapper{display:flex;flex-direction:column;position:absolute}.ck-widget.raw-html-embed .raw-html-embed__preview{display:flex;overflow:hidden;position:relative}.ck-widget.raw-html-embed .raw-html-embed__preview-content{border-collapse:separate;border-spacing:7px;display:table;margin:auto;position:relative;width:100%}.ck-widget.raw-html-embed .raw-html-embed__preview-placeholder{align-items:center;bottom:0;display:flex;justify-content:center;left:0;position:absolute;right:0;top:0}:root{--ck-html-embed-content-width:calc(100% - var(--ck-icon-size)*1.5);--ck-html-embed-source-height:10em;--ck-html-embed-unfocused-outline-width:1px;--ck-html-embed-content-min-height:calc(var(--ck-icon-size) + var(--ck-spacing-standard));--ck-html-embed-source-disabled-background:var(--ck-color-base-foreground);--ck-html-embed-source-disabled-color:#737373}.ck-widget.raw-html-embed{background-color:var(--ck-color-base-foreground);font-size:var(--ck-font-size-base)}.ck-widget.raw-html-embed:not(.ck-widget_selected):not(:hover){outline:var(--ck-html-embed-unfocused-outline-width) dashed var(--ck-color-widget-blurred-border)}.ck-widget.raw-html-embed[dir=ltr]{text-align:left}.ck-widget.raw-html-embed[dir=rtl]{text-align:right}.ck-widget.raw-html-embed:before{background:#999;border-radius:0 0 var(--ck-border-radius) var(--ck-border-radius);color:var(--ck-color-base-background);content:attr(data-html-embed-label);font-family:var(--ck-font-face);font-size:var(--ck-font-size-tiny);left:var(--ck-spacing-standard);padding:calc(var(--ck-spacing-tiny) + var(--ck-html-embed-unfocused-outline-width)) var(--ck-spacing-small) var(--ck-spacing-tiny);top:calc(var(--ck-html-embed-unfocused-outline-width)*-1);transition:background var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve)}.ck-widget.raw-html-embed[dir=rtl]:before{left:auto;right:var(--ck-spacing-standard)}.ck-widget.raw-html-embed[dir=ltr] .ck-widget__type-around .ck-widget__type-around__button.ck-widget__type-around__button_before{margin-left:50px}.ck.ck-editor__editable.ck-blurred .ck-widget.raw-html-embed.ck-widget_selected:before{padding:var(--ck-spacing-tiny) var(--ck-spacing-small);top:0}.ck.ck-editor__editable:not(.ck-blurred) .ck-widget.raw-html-embed.ck-widget_selected:before{background:var(--ck-color-focus-border);padding:var(--ck-spacing-tiny) var(--ck-spacing-small);top:0}.ck.ck-editor__editable .ck-widget.raw-html-embed:not(.ck-widget_selected):hover:before{padding:var(--ck-spacing-tiny) var(--ck-spacing-small);top:0}.ck-widget.raw-html-embed .raw-html-embed__content-wrapper{padding:var(--ck-spacing-standard)}.ck-widget.raw-html-embed .raw-html-embed__buttons-wrapper{right:var(--ck-spacing-standard);top:var(--ck-spacing-standard)}.ck-widget.raw-html-embed .raw-html-embed__buttons-wrapper .ck-button.raw-html-embed__save-button{color:var(--ck-color-button-save)}.ck-widget.raw-html-embed .raw-html-embed__buttons-wrapper .ck-button.raw-html-embed__cancel-button{color:var(--ck-color-button-cancel)}.ck-widget.raw-html-embed .raw-html-embed__buttons-wrapper .ck-button:not(:first-child){margin-top:var(--ck-spacing-small)}.ck-widget.raw-html-embed[dir=rtl] .raw-html-embed__buttons-wrapper{left:var(--ck-spacing-standard);right:auto}.ck-widget.raw-html-embed .raw-html-embed__source{box-sizing:border-box;direction:ltr;font-family:monospace;font-size:var(--ck-font-size-base);height:var(--ck-html-embed-source-height);min-width:0;padding:var(--ck-spacing-standard);resize:none;tab-size:4;text-align:left;white-space:pre-wrap;width:var(--ck-html-embed-content-width)}.ck-widget.raw-html-embed .raw-html-embed__source[disabled]{background:var(--ck-html-embed-source-disabled-background);color:var(--ck-html-embed-source-disabled-color);-webkit-text-fill-color:var(--ck-html-embed-source-disabled-color);opacity:1}.ck-widget.raw-html-embed .raw-html-embed__preview{min-height:var(--ck-html-embed-content-min-height);width:var(--ck-html-embed-content-width)}.ck-editor__editable:not(.ck-read-only) .ck-widget.raw-html-embed .raw-html-embed__preview{pointer-events:none}.ck-widget.raw-html-embed .raw-html-embed__preview-content{background-color:var(--ck-color-base-foreground);box-sizing:border-box}.ck-widget.raw-html-embed .raw-html-embed__preview-content>*{margin-left:auto;margin-right:auto}.ck-widget.raw-html-embed .raw-html-embed__preview-placeholder{color:var(--ck-html-embed-source-disabled-color)}");/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class x extends k{_widgetButtonViewReferences=new Set;static get pluginName(){return"HtmlEmbedEditing"}static get licenseFeatureCode(){return"HE"}static get isOfficialPlugin(){return!0}static get isPremiumPlugin(){return!0}constructor(e){super(e),e.config.define("htmlEmbed",{showPreviews:!1,sanitizeHtml:t=>(L("html-embed-provide-sanitize-function"),{html:t,hasChanged:!1})})}init(){const e=this.editor;e.model.schema.register("rawHtml",{inheritAllFrom:"$blockObject",allowAttributes:["value"]}),e.commands.add("htmlEmbed",new C(e)),this._setupConversion()}_setupConversion(){const e=this.editor,t=e.t,n=e.editing.view,a=this._widgetButtonViewReferences,b=e.config.get("htmlEmbed");this.editor.editing.view.on("render",()=>{for(const o of a){if(o.element&&o.element.isConnected)return;o.destroy(),a.delete(o)}},{priority:"lowest"}),e.data.registerRawContentMatcher({name:"div",classes:"raw-html-embed"}),e.conversion.for("upcast").elementToElement({view:{name:"div",classes:"raw-html-embed"},model:(o,{writer:r})=>r.createElement("rawHtml",{value:o.getCustomProperty("$rawContent")})}),e.conversion.for("dataDowncast").elementToElement({model:"rawHtml",view:(o,{writer:r})=>r.createRawElement("div",{class:"raw-html-embed"},function(l){l.innerHTML=o.getAttribute("value")||""})}),e.conversion.for("editingDowncast").elementToStructure({model:{name:"rawHtml",attributes:["value"]},view:(o,{writer:r})=>{let l,i,d;const s=r.createRawElement("div",{class:"raw-html-embed__content-wrapper"},function(u){l=u,p({editor:e,domElement:u,state:i,props:d}),l.addEventListener("mousedown",()=>{if(i.isEditable){const g=e.model;g.document.selection.getSelectedElement()!==o&&g.change(B=>B.setSelection(o,"on"))}},!0)}),w={makeEditable(){i=Object.assign({},i,{isEditable:!0}),p({domElement:l,editor:e,state:i,props:d}),n.change(u=>{u.setAttribute("data-cke-ignore-events","true",s)}),l.querySelector("textarea").focus()},save(u){u!==i.getRawHtmlValue()?(e.execute("htmlEmbed",u),e.editing.view.focus()):this.cancel()},cancel(){i=Object.assign({},i,{isEditable:!1}),p({domElement:l,editor:e,state:i,props:d}),e.editing.view.focus(),n.change(u=>{u.removeAttribute("data-cke-ignore-events",s)})}};i={showPreviews:b.showPreviews,isEditable:!1,getRawHtmlValue:()=>o.getAttribute("value")||""},d={sanitizeHtml:b.sanitizeHtml,textareaPlaceholder:t("Paste raw HTML here..."),onEditClick(){w.makeEditable()},onSaveClick(u){w.save(u)},onCancelClick(){w.cancel()}};const m=r.createContainerElement("div",{class:"raw-html-embed","data-html-embed-label":t("HTML snippet"),dir:e.locale.uiLanguageDirection},s);return r.setCustomProperty("rawHtmlApi",w,m),r.setCustomProperty("rawHtml",!0,m),V(m,r,{label:t("HTML snippet"),hasSelectionHandle:!0})}});function p({editor:o,domElement:r,state:l,props:i}){r.textContent="";const d=r.ownerDocument;let s;if(l.isEditable){const m={isDisabled:!1,placeholder:i.textareaPlaceholder};s=f({domDocument:d,state:l,props:m}),r.append(s)}else if(l.showPreviews){const m={sanitizeHtml:i.sanitizeHtml};r.append(z({domDocument:d,state:l,props:m,editor:o}))}else{const m={isDisabled:!0,placeholder:i.textareaPlaceholder};r.append(f({domDocument:d,state:l,props:m}))}const w={onEditClick:i.onEditClick,onSaveClick:()=>{i.onSaveClick(s.value)},onCancelClick:i.onCancelClick};r.prepend(P({editor:o,domDocument:d,state:l,props:w}))}function P({editor:o,domDocument:r,state:l,props:i}){const d=h(r,"div",{class:"raw-html-embed__buttons-wrapper"});if(l.isEditable){const s=v(o,"save",i.onSaveClick),w=v(o,"cancel",i.onCancelClick);d.append(s.element,w.element),a.add(s).add(w)}else{const s=v(o,"edit",i.onEditClick);d.append(s.element),a.add(s)}return d}function f({domDocument:o,state:r,props:l}){const i=h(o,"textarea",{placeholder:l.placeholder,class:"ck ck-reset ck-input ck-input-text raw-html-embed__source"});return i.disabled=l.isDisabled,i.value=r.getRawHtmlValue(),i}function z({editor:o,domDocument:r,state:l,props:i}){const d=i.sanitizeHtml(l.getRawHtmlValue()),s=l.getRawHtmlValue().length>0?t("No preview available"):t("Empty snippet content"),w=h(r,"div",{class:"ck ck-reset_all raw-html-embed__preview-placeholder"},s),m=h(r,"div",{class:"raw-html-embed__preview-content",dir:o.locale.contentLanguageDirection}),g=r.createRange().createContextualFragment(d.html);return m.appendChild(g),h(r,"div",{class:"raw-html-embed__preview"},[w,m])}}}function v(c,e,t){const{t:n}=c.locale,a=new _(c.locale),b=c.commands.get("htmlEmbed");return a.set({class:`raw-html-embed__${e}-button`,icon:E,tooltip:!0,tooltipPosition:c.locale.uiLanguageDirection==="rtl"?"e":"w"}),a.render(),e==="edit"?(a.set({icon:E,label:n("Edit source")}),a.bind("isEnabled").to(b)):e==="save"?(a.set({icon:D,label:n("Save changes")}),a.bind("isEnabled").to(b)):a.set({icon:M,label:n("Cancel")}),a.on("execute",t),a}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class y extends k{static get pluginName(){return"HtmlEmbedUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,n=e.locale.t;e.ui.componentFactory.add("htmlEmbed",()=>{const a=this._createButton(_);return a.set({tooltip:!0,label:n("Insert HTML")}),a}),e.ui.componentFactory.add("menuBar:htmlEmbed",()=>{const a=this._createButton(I);return a.set({label:n("HTML snippet")}),a})}_createButton(e){const t=this.editor,n=t.commands.get("htmlEmbed"),a=new e(t.locale);return a.set({icon:O}),a.bind("isEnabled").to(n,"isEnabled"),this.listenTo(a,"execute",()=>{t.execute("htmlEmbed"),t.editing.view.focus(),t.editing.view.document.selection.getSelectedElement().getCustomProperty("rawHtmlApi").makeEditable()}),a}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class F extends k{static get requires(){return[x,y,A]}static get pluginName(){return"HtmlEmbed"}static get isOfficialPlugin(){return!0}}export{F as HtmlEmbed,C as HtmlEmbedCommand,x as HtmlEmbedEditing,y as HtmlEmbedUI};
