import{ElementApiMixin as u,Editor as c,secureSourceElement as f,attachToForm as p}from"@ckeditor/ckeditor5-core";import{ResizeObserver as g,toUnit as b,Rect as m,CKEditorError as a,getDataFromElement as w}from"@ckeditor/ckeditor5-utils";import{EditorUI as y,normalizeToolbarConfig as T,EditorUIView as v,ToolbarView as P,MenuBarView as E,BalloonPanelView as O,InlineEditableUIView as V}from"@ckeditor/ckeditor5-ui";import{enableViewPlaceholder as _}from"@ckeditor/ckeditor5-engine";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class d extends y{view;_toolbarConfig;constructor(t,e){super(t),this.view=e,this._toolbarConfig=T(t.config.get("toolbar"))}get element(){return this.view.editable.element}init(){const t=this.editor,e=this.view,i=t.editing.view,n=e.editable,s=i.document.getRoot();n.name=s.rootName,e.render();const l=n.element;this.setEditableElement(n.name,l),n.bind("isFocused").to(this.focusTracker),i.attachDomRoot(l),this._initPlaceholder(),this._initToolbar(),e.menuBarView&&this.initMenuBar(e.menuBarView),this.fire("ready")}destroy(){super.destroy();const t=this.view,e=this.editor.editing.view;e.getDomRoot(t.editable.name)&&e.detachDomRoot(t.editable.name),t.destroy()}_initToolbar(){const t=this.editor,e=this.view,i=e.editable.element,n=e.toolbar;e.panel.bind("isVisible").to(this.focusTracker,"isFocused"),e.bind("viewportTopOffset").to(this,"viewportOffset",({visualTop:s})=>s||0),e.listenTo(t.ui,"update",()=>{e.panel.isVisible&&e.panel.pin({target:i,positions:e.panelPositions})}),n.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(n)}_initPlaceholder(){const t=this.editor,e=t.editing.view,i=e.document.getRoot(),n=t.config.get("placeholder");if(n){const s=typeof n=="string"?n:n[i.rootName];s&&(i.placeholder=s)}_({view:e,element:i,isDirectHost:!1,keepOnFocus:!0})}}function B(o,{insertAt:t}={}){if(typeof document>"u")return;const e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",window.litNonce&&i.setAttribute("nonce",window.litNonce),t==="top"&&e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i),i.styleSheet?i.styleSheet.cssText=o:i.appendChild(document.createTextNode(o))}B(".ck.ck-menu-bar{border:none;border-bottom:1px solid var(--ck-color-toolbar-border)}");/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const x=b("px");class h extends v{toolbar;panel;panelPositions;editable;_resizeObserver;constructor(t,e,i,n={}){super(t),this.toolbar=new P(t,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull,isFloating:!0}),n.useMenuBar&&(this.menuBarView=new E(t)),this.set("viewportTopOffset",0),this.panel=new O(t),this.panelPositions=this._getPanelPositions(),this.panel.extendTemplate({attributes:{class:"ck-toolbar-container"}}),this.editable=new V(t,e,i,{label:n.label}),this._resizeObserver=null}render(){if(super.render(),this.body.add(this.panel),this.registerChild(this.editable),this.menuBarView?this.panel.content.addMany([this.menuBarView,this.toolbar]):this.panel.content.add(this.toolbar),this.toolbar.options.shouldGroupWhenFull){const e=this.editable.element;this._resizeObserver=new g(e,()=>{this.toolbar.maxWidth=x(new m(e).width)})}}destroy(){super.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_getPanelPositionTop(t,e){let i;return t.top>e.height+this.viewportTopOffset?i=t.top-e.height:t.bottom>e.height+this.viewportTopOffset+50?i=this.viewportTopOffset:i=t.bottom,i}_getPanelPositions(){const t=[(e,i)=>({top:this._getPanelPositionTop(e,i),left:e.left,name:"toolbar_west",config:{withArrow:!1}}),(e,i)=>({top:this._getPanelPositionTop(e,i),left:e.left+e.width-i.width,name:"toolbar_east",config:{withArrow:!1}})];return this.locale.uiLanguageDirection==="ltr"?t:t.reverse()}}function F(o){return typeof o=="object"&&o!==null}function C(o){if(typeof o!="object"||o==null)return!1;if(Object.getPrototypeOf(o)===null)return!0;if(Object.prototype.toString.call(o)!=="[object Object]"){const e=o[Symbol.toStringTag];return e==null||!Object.getOwnPropertyDescriptor(o,Symbol.toStringTag)?.writable?!1:o.toString()===`[object ${e}]`}let t=o;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(o)===t}function I(o){return F(o)&&o.nodeType===1&&!C(o)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class S extends u(c){static get editorName(){return"InlineEditor"}ui;constructor(t,e={}){if(!r(t)&&e.initialData!==void 0)throw new a("editor-create-initial-data",null);super(e),this.config.define("menuBar.isVisible",!1),this.config.get("initialData")===void 0&&this.config.set("initialData",N(t)),this.model.document.createRoot(),r(t)&&(this.sourceElement=t,f(this,t));const i=!this.config.get("toolbar.shouldNotGroupWhenFull"),n=this.config.get("menuBar"),s=new h(this.locale,this.editing.view,this.sourceElement,{shouldToolbarGroupWhenFull:i,useMenuBar:n.isVisible,label:this.config.get("label")});this.ui=new d(this,s),p(this)}destroy(){const t=this.getData();return this.ui.destroy(),super.destroy().then(()=>{this.sourceElement&&this.updateSourceElement(t)})}static create(t,e={}){return new Promise(i=>{if(r(t)&&t.tagName==="TEXTAREA")throw new a("editor-wrong-element",null);const n=new this(t,e);i(n.initPlugins().then(()=>n.ui.init()).then(()=>n.data.init(n.config.get("initialData"))).then(()=>n.fire("ready")).then(()=>n))})}}function N(o){return r(o)?w(o):o}function r(o){return I(o)}export{S as InlineEditor,d as InlineEditorUI,h as InlineEditorUIView};
