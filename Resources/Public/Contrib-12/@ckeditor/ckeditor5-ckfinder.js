import{Plugin as u,Command as F}from"@ckeditor/ckeditor5-core";import{ButtonView as m,MenuBarMenuListItemButtonView as I,Notification as U}from"@ckeditor/ckeditor5-ui";import{IconBrowseFiles as p,IconImageAssetManager as f}from"@ckeditor/ckeditor5-icons";import{CKEditorError as w}from"@ckeditor/ckeditor5-utils";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class b extends u{static get pluginName(){return"CKFinderUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;e.ui.componentFactory.add("ckfinder",()=>this._createFileToolbarButton()),e.ui.componentFactory.add("menuBar:ckfinder",()=>this._createFileMenuBarButton()),e.plugins.has("ImageInsertUI")&&e.plugins.get("ImageInsertUI").registerIntegration({name:"assetManager",observable:()=>e.commands.get("ckfinder"),buttonViewCreator:()=>this._createImageToolbarButton(),formViewCreator:()=>this._createImageDropdownButton(),menuBarButtonViewCreator:t=>this._createImageMenuBarButton(t?"insertOnly":"insertNested")})}_createButton(e){const t=this.editor,i=t.locale,n=new e(i),s=t.commands.get("ckfinder");return n.bind("isEnabled").to(s),n.on("execute",()=>{t.execute("ckfinder"),t.editing.view.focus()}),n}_createFileToolbarButton(){const e=this.editor.locale.t,t=this._createButton(m);return t.icon=p,t.label=e("Insert image or file"),t.tooltip=!0,t}_createImageToolbarButton(){const e=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),i=this._createButton(m);return i.icon=f,i.bind("label").to(t,"isImageSelected",n=>e(n?"Replace image with file manager":"Insert image with file manager")),i.tooltip=!0,i}_createImageDropdownButton(){const e=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),i=this._createButton(m);return i.icon=f,i.withText=!0,i.bind("label").to(t,"isImageSelected",n=>e(n?"Replace with file manager":"Insert with file manager")),i.on("execute",()=>{t.dropdownView.isOpen=!1}),i}_createFileMenuBarButton(){const e=this.editor.locale.t,t=this._createButton(I);return t.icon=p,t.withText=!0,t.label=e("File"),t}_createImageMenuBarButton(e){const t=this.editor.locale.t,i=this.editor.locale.t,n=this._createButton(I);switch(n.icon=f,n.withText=!0,e){case"insertOnly":n.label=t("Image");break;case"insertNested":n.label=i("With file manager");break}return n}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class B extends F{constructor(e){super(e),this.affectsData=!1,this.stopListening(this.editor.model.document,"change"),this.listenTo(this.editor.model.document,"change",()=>this.refresh(),{priority:"low"})}refresh(){const e=this.editor.commands.get("insertImage"),t=this.editor.commands.get("link");this.isEnabled=e.isEnabled||t.isEnabled}execute(){const e=this.editor,t=this.editor.config.get("ckfinder.openerMethod")||"modal";if(t!="popup"&&t!="modal")throw new w("ckfinder-unknown-openermethod",e);const i=this.editor.config.get("ckfinder.options")||{};i.chooseFiles=!0;const n=i.onInit;i.language||(i.language=e.locale.uiLanguage),i.onInit=s=>{n&&n(s),s.on("files:choose",l=>{const a=l.data.files.toArray(),g=a.filter(r=>!r.isImage()),c=a.filter(r=>r.isImage());for(const r of g)e.execute("link",r.getUrl());const d=[];for(const r of c){const h=r.getUrl();d.push(h||s.request("file:getProxyUrl",{file:r}))}d.length&&k(e,d)}),s.on("file:choose:resizedImage",l=>{const a=l.data.resizedUrl;if(!a){const g=e.plugins.get("Notification"),c=e.locale.t;g.showWarning(c("Could not obtain resized image URL."),{title:c("Selecting resized image failed"),namespace:"ckfinder"});return}k(e,[a])})},window.CKFinder[t](i)}}function k(o,e){if(!o.commands.get("insertImage").isEnabled){const i=o.plugins.get("Notification"),n=o.locale.t;i.showWarning(n("Could not insert image at the current position."),{title:n("Inserting image failed"),namespace:"ckfinder"});return}o.execute("insertImage",{source:e})}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class C extends u{static get pluginName(){return"CKFinderEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[U,"LinkEditing"]}init(){const e=this.editor;if(!e.plugins.has("ImageBlockEditing")&&!e.plugins.has("ImageInlineEditing"))throw new w("ckfinder-missing-image-plugin",e);e.commands.add("ckfinder",new B(e))}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class _ extends u{static get pluginName(){return"CKFinder"}static get isOfficialPlugin(){return!0}static get requires(){return["Link","CKFinderUploadAdapter",C,b]}}export{_ as CKFinder,B as CKFinderCommand,C as CKFinderEditing,b as CKFinderUI};
